---
session_id: "c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e"
session_id_source: "provided"
created: "2026-01-13T18:39:22Z"
updated: "2026-01-13T18:45:02Z"
status: "active"
commit: ""
topic: ""
tags: []
project_dir: "/Users/claudiuconstantinbogdan/projects/devostack/hack-for-facts-eb-client"
cwd: "/Users/claudiuconstantinbogdan/projects/devostack/hack-for-facts-eb-client"
---

# Session Decisions: c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e

## Decisions

### PROMPT: User input
**Time**: 2026-01-13T18:39:22Z
**Source**: UserPromptSubmit
**Score**: 1
**Decision ID**: c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e-20260113T183922Z-UserPrompt-3262

On Vercel you can reduce that SSR “processing” time (TTFB) by caching either the full HTML response at the CDN, or caching the data fetch, or both. Your graph shows phase="processing" jumped after SSR, which is consistent with “server does more work before first byte”.

Option A: Cache the full SSR HTML at Vercel’s CDN (recommended for public entity pages)

Vercel can cache dynamic SSR responses (including SSR pages) when you return appropriate cache headers.
Use an ISR-like header (short fre...

---

### USER: Cache Variance
**Time**: 2026-01-13T18:43:54Z
**Source**: AskUserQuestion
**Score**: 5
**Decision ID**: c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e-20260113T184354Z-AskUserQuestion-17347-q1
**Context**: Cache Variance
**Multi-select**: false

**Question**: The entity page loader reads user preferences from cookies (currency, inflation adjusted) to determine default data fetching. This means the same URL (e.g., /entities/123) could render differently based on cookies. How should we handle this for CDN caching?

**Options**:
1. **Ignore cookie variance (Recommended)** - Most users use default preferences. Accept that some users with custom preferences may see stale defaults until revalidation. URL params override anyway.
2. **Add Vary: Cookie header** - CDN will cache per unique Cookie header. This reduces cache hit rate but ensures correct content for all users.
3. **Force URL params for preferences** - Always redirect users with custom preferences to include ?currency=EUR etc in URL, making cache key explicit.

**Selected**: Ignore cookie variance (Recommended)

---

### PLAN: Plan: Implement Vercel CDN Caching Headers for Entity Pages
**Time**: 2026-01-13T18:44:26Z
**Source**: ExitPlanMode
**Score**: 4
**Decision ID**: c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e-20260113T184426Z-ExitPlanMode-18722-plan
**Plan created**: 2026-01-13T20:44:03Z
**Lines**: 59
**Approved in**: /Users/claudiuconstantinbogdan/projects/devostack/hack-for-facts-eb-client

**Files**:
- Original: /Users/claudiuconstantinbogdan/.claude/plans/gentle-spinning-flask.md
- Archived: .claude/plans/archived/gentle-spinning-flask-20260113T184426Z.md
- Archived (full): /Users/claudiuconstantinbogdan/projects/devostack/hack-for-facts-eb-client/.claude/plans/archived/gentle-spinning-flask-20260113T184426Z.md

**Summary**:
Based on the plan, here are the key decisions:

• **Add Vercel-specific CDN headers** to entity pages (`entities.$cui.tsx` and `entity-analytics.tsx`) alongside updated Cache-Control headers for explicit Vercel CDN control

• **Extend stale-while-revalidate window from 1h to 24h** to allow serving stale content longer while background revalidation happens, reducing SSR TTFB

• **Ignore cookie-based variance** in caching since most users use default preferences and URL params override cookies anyway; users with custom settings will see defaults until client-side hydration

---

### IMPL: Initial task breakdown
**Time**: 2026-01-13T18:44:37Z
**Source**: TodoWrite
**Score**: 3
**Decision ID**: c7acb606-08aa-4d1b-a4a8-d2c2a19a2c7e-20260113T184437Z-TodoWrite-20005-tasks
**Tasks**: 3 (0 done, 1 active, 2 pending)

- [~] Update entities.$cui.tsx headers
- [ ] Update entity-analytics.tsx headers
- [ ] Run typecheck to verify changes

---

